(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{31:function(e,t,n){},38:function(e,t,n){e.exports=n(61)},43:function(e,t,n){},48:function(e,t,n){},50:function(e,t,n){},51:function(e,t,n){},60:function(e,t,n){},61:function(e,t,n){"use strict";n.r(t);var a=n(0),s=n.n(a),o=n(33),r=n.n(o),i=n(24),l=n(17),c=n(18),u=n(22),m=n(19),h=n(21),f=n(1),d=(n(43),function(e){return s.a.createElement("div",{className:"profile-flex"},s.a.createElement("div",{className:"profile-image"},s.a.createElement("img",{id:"profile-image",src:e.profilePicture,alt:"profile"})),s.a.createElement("div",{className:"profile-info"},s.a.createElement("div",null,e.username),s.a.createElement("div",null,e.usernameShort),s.a.createElement("div",null,"Tweets: ",e.tweetCounter)))}),p=n(12),w=n(34),g=n.n(w),b=function(e){return s.a.createElement("p",null,e.comment)},v=n(15),E=n(25),O=n(26);n(48);v.b.add(O.b,O.a);var y=function(e){var t=[];Object(a.useEffect)(function(){var n=[];n[0]=e.tweet,t=1===n[0].length?n[0][0].split("&?"):n[0].split("&?"),i(t)},[e.tweet]);var n=Object(a.useState)([]),o=Object(p.a)(n,2),r=o[0],i=o[1],l=Object(a.useState)(!1),c=Object(p.a)(l,2),u=c[0],m=c[1],h=Object(a.useState)(""),f=Object(p.a)(h,2),d=f[0],w=f[1],v=Object(a.useState)(!1),O=Object(p.a)(v,2),y=O[0],j=O[1];return s.a.createElement(s.a.Fragment,null,s.a.createElement("li",{className:"list-item"},s.a.createElement("div",{className:"tweet-picture-container"},s.a.createElement("img",{src:e.profilePicture,alt:"profile"})),s.a.createElement("div",{className:"tweet-content"},s.a.createElement("span",{className:"tweet-username"},e.usernameShort),s.a.createElement(g.a,{className:"tweet-time",time:e.timesOfTweet,autoUpdate:!0}),s.a.createElement("p",null,r[0]))),s.a.createElement("div",{className:"comments-input"},s.a.createElement("input",{type:"text",placeholder:"Please enter your comment and press Enter",className:u?"comments-input-open":"comments-input-closed",value:d,onChange:function(e){return w(e.target.value)},onKeyDown:function(t){e.comment(e,d,t.keyCode),13===t.keyCode&&(w(""),j(!0)),setTimeout(function(){j(!1)},2e3)}}),s.a.createElement("div",{className:y?"posted-indicator posted":"posted-indicator not-posted"},s.a.createElement("span",null,"Posted")),u?s.a.createElement("button",{className:"open-comments-button --opened-comments",onClick:function(){return m(!u)}},s.a.createElement(E.a,{icon:"eye-slash",size:"lg"})):s.a.createElement("button",{className:"open-comments-button --closed-comments",onClick:function(){return m(!u)}},s.a.createElement(E.a,{icon:"comments",size:"lg"}))),s.a.createElement("div",{className:u?"comments comments-open":"comments comments-closed"},r.map(function(e,t){return 0===t?null:s.a.createElement("div",{key:t},s.a.createElement(b,{comment:e}))})))},j=(n(31),function(e){return s.a.createElement("div",{className:"tweetbox-container"},s.a.createElement("ul",null,e.tweets.map(function(t,n){return s.a.createElement(y,{key:n,datakey:n,length:e.tweets.length,tweet:t,timesOfTweet:e.timesOfTweets[n],usernameShort:e.usernameShort,profilePicture:e.profilePicture,comment:e.comment,owner_id:e.owner_id})})))}),k=n(23),C=n.n(k),S=function(e){function t(){return Object(l.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=C.a.Widget(this.uploader),n=this.props,a=n.value,s=n.onChange,o=n.onUploadComplete;"undefined"!==typeof a&&t.value(a),"function"===typeof s&&t.onChange(function(t){e.files=t?e.files&&e.files.files?e.files.files():[e.files]:null,s(t)}),"function"===typeof o&&t.onUploadComplete(o),t.onDialogOpen(function(t){return e.dialog=t})}},{key:"componentWillUnmount",value:function(){this.dialog&&this.dialog.reject(),this.files&&C.a.jQuery.when.apply(null,this.files).cancel();var e=C.a.jQuery(this.uploader).next(".uploadcare--widget"),t=e.data("uploadcareWidget");t&&t.inputElement===this.uploader&&e.remove()}},{key:"getInputAttributes",value:function(){var e=Object.assign({},this.props);return delete e.value,delete e.onChange,delete e.onUploadComplete,e}},{key:"render",value:function(){var e=this,t=this.getInputAttributes();return s.a.createElement("input",Object.assign({type:"hidden",ref:function(t){return e.uploader=t}},t))}}]),t}(a.Component),P=[],N=function(e){return function(){var t=[],n=[];t.push(e.tweets),t.map(function(e){return e.map(function(e){return e.timesOfTweets.map(function(t,a){return n.push([t,e.tweets[a],e.username,e.profilePicture,e.owner_id]),P=n.sort(function(e,t){return t[0]-e[0]})}),null}),null})}(),0!==e.tweets.length?s.a.createElement("div",{className:"tweetbox-container"},s.a.createElement("ul",null,P.map(function(t,n){return s.a.createElement(y,{datakey:n,key:n,usernameShort:"@"+t[2].toLowerCase().replace(/\s/g,""),timesOfTweet:t[0],profilePicture:t[3],tweet:t[1],comment:e.comment,owner_id:t[4]})}))):null},_=(n(50),function(e){var t=Object(a.useState)(!1),n=Object(p.a)(t,2),o=n[0],r=n[1];return Object(a.useEffect)(function(){!function(){for(var t=0;t<e.following.length;t++){if(e.id===e.following[t].owner_id){r(!0);break}r(!1)}}()},[e.item]),s.a.createElement("div",{className:"search-item-with-button"},s.a.createElement("div",{className:"search-item-container"},s.a.createElement("img",{className:"search-item-img",src:e.item.profilePicture,alt:"profile"}),s.a.createElement("div",{className:"search-item-username"},s.a.createElement("p",null,e.item.username),s.a.createElement("p",null,"@"+e.item.username.toLowerCase().replace(/\s/g,"")),s.a.createElement("p",null,"Tweets: ",e.item.tweets.length))),o?s.a.createElement("button",{className:"unfollow",onClick:function(){e.unfollow(e.item),r(!1)}},"Unfollow"):s.a.createElement("button",{className:"follow",onClick:function(){e.follow(e.item),r(!0)}},"Follow"))}),I=(n(51),function(e){return s.a.createElement("ul",{className:"search-list"},e.searchResultsArray.map(function(t,n){return s.a.createElement("li",{className:"search-list-item",key:n},s.a.createElement(_,{item:t,id:t.owner_id,follow:e.follow,unfollow:e.unfollow,following:e.following}))}))}),T=n(16),F=n(11),D=function(){return s.a.createElement("div",null,"ConfirmEmail")},x=function(){return s.a.createElement("h1",null,"ResetPassword")},A=n(7),R=A.c.initializeDefaultAppClient("twitter-clone-hgeer"),U=function(){return s.a.createElement(T.a,null,s.a.createElement("div",null,s.a.createElement("nav",null,s.a.createElement("ul",null,s.a.createElement("li",null,s.a.createElement(T.b,{to:"/"},"Home")),s.a.createElement("li",null,s.a.createElement(T.b,{to:"/confirmEmail/"},"About")),s.a.createElement("li",null,s.a.createElement(T.b,{to:"/resetPassword/"},"Users")))),s.a.createElement(F.a,{path:"/",exact:!0,component:K}),s.a.createElement(F.a,{path:"/confirmEmail/",component:D}),s.a.createElement(F.a,{path:"/resetPassword/",component:x})))},K=(n(60),function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(u.a)(this,Object(m.a)(t).call(this,e))).state={profilePicture:"logo.png",username:"",timesOfTweets:[],tweets:[],tweetValue:"",usernameValue:"",search:"",searchEmpty:!0,searchResultsArray:[],following:[],home:!0,owner_id:"",email:"",password:""},n.usernameInput=n.usernameInput.bind(Object(f.a)(Object(f.a)(n))),n.usernameInputKeyHandler=n.usernameInputKeyHandler.bind(Object(f.a)(Object(f.a)(n))),n.handleTweetChange=n.handleTweetChange.bind(Object(f.a)(Object(f.a)(n))),n.handleTweetKeyDown=n.handleTweetKeyDown.bind(Object(f.a)(Object(f.a)(n))),n.post=n.post.bind(Object(f.a)(Object(f.a)(n))),n.updateDb=n.updateDb.bind(Object(f.a)(Object(f.a)(n))),n.uploadPicture=n.uploadPicture.bind(Object(f.a)(Object(f.a)(n))),n.getSearch=n.getSearch.bind(Object(f.a)(Object(f.a)(n))),n.clearSearch=n.clearSearch.bind(Object(f.a)(Object(f.a)(n))),n.searchResults=n.searchResults.bind(Object(f.a)(Object(f.a)(n))),n.follow=n.follow.bind(Object(f.a)(Object(f.a)(n))),n.unfollow=n.unfollow.bind(Object(f.a)(Object(f.a)(n))),n.setIntitalState=n.setIntitalState.bind(Object(f.a)(Object(f.a)(n))),n.comment=n.comment.bind(Object(f.a)(Object(f.a)(n))),n.checkForChanges=n.checkForChanges.bind(Object(f.a)(Object(f.a)(n))),n.checkForOwnChanges=n.checkForOwnChanges.bind(Object(f.a)(Object(f.a)(n))),n.registerEmail=n.registerEmail.bind(Object(f.a)(Object(f.a)(n))),n.confirmEmail=n.confirmEmail.bind(Object(f.a)(Object(f.a)(n))),n.resultsSorted=n.resetPassword.bind(Object(f.a)(Object(f.a)(n))),n.emailInput=n.emailInput.bind(Object(f.a)(Object(f.a)(n))),n.passwordInput=n.passwordInput.bind(Object(f.a)(Object(f.a)(n))),n.db=R.getServiceClient(A.b.factory,"mongodb-atlas").db("test"),n.user=R.auth.loginWithCredential(new A.a),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"registerEmail",value:function(e,t){A.c.defaultAppClient.auth.getProviderClient(A.d.factory).registerWithEmail(e,t).then(function(){console.log("Successfully sent account confirmation email!")}).catch(function(e){console.log("Error registering new user:",e)})}},{key:"emailInput",value:function(e){this.setState({email:e.target.value})}},{key:"passwordInput",value:function(e){this.setState({password:e.target.value})}},{key:"confirmEmail",value:function(){var e=window.location.search,t=new URLSearchParams(e),n=t.get("token"),a=t.get("tokenId");return A.c.defaultAppClient.auth.getProviderClient(A.d.factory).confirmUser(n,a)}},{key:"resetPassword",value:function(e){var t=window.location.search,n=new URLSearchParams(t),a=n.get("token"),s=n.get("tokenId");A.c.defaultAppClient.auth.getProviderClient(A.d.factory).resetPassword(a,s,e).then(function(){console.log("Successfully reset password!")}).catch(function(e){console.log("Error resetting password:",e)})}},{key:"usernameInput",value:function(e){this.setState({usernameValue:e.target.value})}},{key:"usernameInputKeyHandler",value:function(e){"Enter"===e.key&&(e.target.value||alert("name can't be empty"),this.setState({username:this.state.usernameValue}))}},{key:"handleTweetChange",value:function(e){this.setState({tweetValue:e.target.value})}},{key:"handleTweetKeyDown",value:function(e){"Enter"===e.key&&this.post()}},{key:"post",value:function(){if(""!==this.state.tweetValue){var e=this.state.tweets,t=this.state.timesOfTweets,n=(new Date).getTime()/1e3;t.unshift(n),e.unshift(this.state.tweetValue),this.setState({tweets:e,timesOfTweets:t,tweetValue:""}),this.updateDb()}}},{key:"updateDb",value:function(){this.db.collection("test").updateOne({owner_id:R.auth.user.id},{$set:{profilePicture:this.state.profilePicture,username:this.state.usernameValue||this.state.username,tweets:this.state.tweets,timesOfTweets:this.state.timesOfTweets,following:this.state.following}},{upsert:!0}).catch(function(e){console.error(e)})}},{key:"uploadPicture",value:function(e){this.db.collection("test").updateOne({owner_id:R.auth.user.id},{$set:{profilePicture:"https://ucarecdn.com/"+e.uuid+"/-/resize/150x/"}},this.setState({profilePicture:"https://ucarecdn.com/"+e.uuid+"/-/resize/150x/"}),{upsert:!0}).catch(function(e){console.error(e)})}},{key:"getSearch",value:function(e){""!==e.target.value?(this.setState({searchEmpty:!1}),this.searchResults(e.target.value)):this.setState({searchEmpty:!0}),this.setState({search:e.target.value})}},{key:"clearSearch",value:function(){this.setState({searchEmpty:!0,search:""})}},{key:"searchResults",value:function(e){var t=this;this.db.collection("test").find({username:new RegExp(e)}).toArray().then(function(e){e.length>0&&t.setState({searchResultsArray:Object(i.a)(e)})})}},{key:"follow",value:function(e){var t=this.state.following;t.push(e),this.setState({following:Object(i.a)(t)})}},{key:"unfollow",value:function(e){var t=this.state.following.filter(function(t){return t.owner_id!==e.owner_id});0===t.length&&this.setState({following:[]}),this.setState({following:Object(i.a)(t)})}},{key:"setIntitalState",value:function(){var e=this;this.user.then(function(){return e.db.collection("test").findOne({owner_id:R.auth.user.id})}).then(function(t){t&&e.setState({profilePicture:t.profilePicture||"logo.png",tweets:t.tweets,timesOfTweets:t.timesOfTweets,username:t.username,following:t.following||[],owner_id:t.owner_id})}).catch(function(e){console.error(e)})}},{key:"comment",value:function(e,t,n){var a=this;console.log(e,t,n),13===n&&""!==t&&(console.log("Enter pressed"),this.user.then(function(){return a.db.collection("test").findOne({owner_id:e.owner_id})}).then(function(n){var s=n.timesOfTweets.indexOf(e.timesOfTweet);console.log(s);var o=n.tweets;o[s]=o[s]+"&?"+t+" :@"+a.state.username.toLowerCase().replace(/\s/g,""),console.log(o),a.checkForChanges(),a.db.collection("test").updateOne({owner_id:e.owner_id},{$set:{tweets:o}},{upsert:!0}).catch(function(e){console.error(e)}),e.owner_id===R.auth.user.id?a.setState({tweets:o}):(a.checkForChanges(),a.updateDb())}).catch(function(e){console.error(e)}))}},{key:"checkForChanges",value:function(){for(var e=this,t=[],n=0;n<this.state.following.length;n++)t.push(this.state.following[n].owner_id);this.db.collection("test").find({owner_id:{$in:t}}).toArray().then(function(t){for(var n=t.sort(function(e,t){return e.owner_id>t.owner_id?1:t.owner_id>e.owner_id?-1:0}),a=e.state.following.sort(function(e,t){return e.owner_id>t.owner_id?1:t.owner_id>e.owner_id?-1:0}),s=0;s<a.length;s++)for(var o=0;o<n[s].tweets.length;o++)n[s].tweets[o]===a[s].tweets[o]&&n[s].profilePicture===a[s].profilePicture||(e.setState({following:n}),console.log("change in following"))})}},{key:"checkForOwnChanges",value:function(){var e=this;this.user.then(function(){return e.db.collection("test").findOne({owner_id:R.auth.user.id})}).then(function(t){for(var n=0;n<t.tweets.length&&t.tweets[n]!==e.state.tweets[n];n++)console.log("base: ",t.tweets[n],"state: ",e.state.tweets[n]),e.setState({tweets:t.tweets})}).catch(function(e){console.error(e)})}},{key:"componentDidMount",value:function(){var e=this;this.registerEmail(this.state.email,this.state.password),this.setIntitalState(),this.interval=setInterval(function(){return e.checkForChanges()},1e3),this.selfInterval=setInterval(function(){return e.checkForOwnChanges()},1e3),console.log(R)}},{key:"componentDidUpdate",value:function(e,t){this.state.profilePicture===t.profilePicture&&this.state.tweets===t.tweets&&this.state.username===t.username&&this.state.following===t.following&&this.state.home===t.home||(this.checkForChanges(),this.updateDb())}},{key:"componentWillUnmount",value:function(){clearInterval(this.interval)}},{key:"render",value:function(){var e=this;return""===this.state.username?s.a.createElement("div",{className:"login-container animation"},s.a.createElement("div",{className:"logo-container"},s.a.createElement("img",{src:"logo.png",alt:"logo"})),s.a.createElement("p",null,"Welcome to Twudder (like a twitter, but with no annoying tweets)"),s.a.createElement("div",{className:"username-input-container"},s.a.createElement("input",{id:"username-input",type:"text",value:this.state.usernameValue,onChange:this.usernameInput,onKeyDown:this.usernameInputKeyHandler}),s.a.createElement("label",{className:"username-input-label",htmlFor:"username-input"},"Please enter your name and press Enter")),s.a.createElement("input",{type:"text",value:this.state.email,onChange:this.emailInput}),s.a.createElement("input",{type:"secret",value:this.state.password,onChange:this.passwordInput}),s.a.createElement("button",{onClick:function(){return e.registerEmail(e.state.email,e.state.password)}},"Register")):s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"search-container"},s.a.createElement("div",{className:"search-input-container"},s.a.createElement("input",{id:"search",type:"text",value:this.state.search,onChange:this.getSearch,placeholder:"Search..."}),s.a.createElement("button",{onClick:this.clearSearch},"Clear")),this.state.searchEmpty?null:s.a.createElement(I,{searchResultsArray:this.state.searchResultsArray,following:this.state.following,follow:this.follow,unfollow:this.unfollow})),s.a.createElement("div",{className:"container"},s.a.createElement("div",{className:"profile-container"},s.a.createElement(d,{profilePicture:this.state.profilePicture,username:this.state.username,usernameShort:"@"+this.state.username.toLowerCase().replace(/\s/g,""),tweetCounter:this.state.tweets.length}),s.a.createElement("div",{className:"uploader"},s.a.createElement("label",{htmlFor:"file"},"Change Picture:")," ",s.a.createElement(S,{id:"file",name:"file","data-tabs":"file camera",onChange:function(e){console.log("File changed: ",e),e&&(e.progress(function(e){return console.log("File progress: ",e.progress)}),e.done(function(e){return console.log("File uploaded: ",e)}))},onUploadComplete:function(t){return e.uploadPicture(t)}}))),s.a.createElement("div",{className:"buttons-and-tweets"},s.a.createElement("div",{className:"buttons-container"},s.a.createElement("button",{className:this.state.home?"button --active":"button",onClick:function(){return e.setState({home:!0})}},"Home"),s.a.createElement("button",{className:this.state.home?"button":"button --active",onClick:function(){return e.setState({home:!1})}},"Feed")),s.a.createElement("div",{className:"tweets-container"},this.state.home?s.a.createElement("div",{className:"post-container"},s.a.createElement("input",{id:"post",type:"text",value:this.state.tweetValue,onChange:this.handleTweetChange,onKeyDown:this.handleTweetKeyDown}),s.a.createElement("label",{className:"post-label",htmlFor:"post"},"Please enter your tweet and press Enter")):null,this.state.home?s.a.createElement(j,{tweets:this.state.tweets,timesOfTweets:this.state.timesOfTweets,profilePicture:this.state.profilePicture,usernameShort:"@"+this.state.username.toLowerCase().replace(/\s/g,""),comment:this.comment,owner_id:this.state.owner_id}):s.a.createElement(N,{tweets:this.state.following,comment:this.comment})))))}}]),t}(a.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(s.a.createElement(U,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[38,1,2]]]);
//# sourceMappingURL=main.3c9b89ad.chunk.js.map